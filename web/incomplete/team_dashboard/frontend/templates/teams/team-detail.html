{% extends "base.html" %}

{% block title %}{{ team.name if team else 'Team Not Found' }} - TeamDashboard{% endblock %}

{% block extra_css %}
<link href="{{ url_for('static', path='css/teams.css') }}" rel="stylesheet">
{% endblock %}

{% block content %}
<div class="team-detail-container">
    {% if error %}
    <div style="background: var(--error); color: white; padding: 15px; border-radius: 8px; margin-bottom: 2rem;">
        {{ error }}
    </div>
    {% endif %}

    {% if team %}
    <div class="team-detail-card">
        <div class="team-detail-header">
            <h1 class="team-detail-title">{{ team.name }}</h1>
            <div class="team-detail-meta">
                {% if is_moderator %}
                <span class="team-role role-moderator">Moderator</span>
                {% else %}
                <span class="team-role role-member">Member</span>
                {% endif %}
            </div>
        </div>

        <!-- Members Section -->
        <div class="members-section">
            <h3 class="section-title">Team Members ({{ members|length }})</h3>
            <div class="members-grid">
                {% for member in members %}
                <div class="member-card">
                    <div class="member-info">
                        <span class="member-name">{{ member.user.username }}</span>
                        <span class="member-role">
                            {% if member.is_moderator %}Moderator{% else %}Member{% endif %}
                        </span>
                    </div>
                    {% if is_moderator and member.user_id != current_user.id %}
                    <form method="POST" action="/team/{{ team.id }}/members/{{ member.user_id }}/remove" style="display: inline;">
                        <button type="submit" class="btn btn-secondary btn-sm" 
                            onclick="return confirm('Remove {{ member.user.username }} from the team?')">
                            Remove
                        </button>
                    </form>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- Tasks Section -->
        <div class="tasks-section">
            <h3 class="section-title">Team Tasks ({{ tasks|length }})</h3>
            {% if tasks %}
            <div class="tasks-mini-list">
                {% for task in tasks %}
                <div class="task-mini-card" onclick="window.location.href='/tasks/{{ task.id }}'">
                    <div>
                        <div class="task-mini-title">{{ task.title }}</div>
                        <div style="font-size: 0.85rem; color: var(--text-secondary);">
                            by {{ task.owner.username }}
                        </div>
                    </div>
                    <span class="task-mini-status {{ task.status }}">{{ task.status }}</span>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <p style="color: var(--text-secondary); text-align: center; padding: 2rem;">
                No tasks assigned to this team yet.
            </p>
            {% endif %}
        </div>

        <div class="team-detail-actions">
            <a href="/team" class="btn btn-outline">Back to Teams</a>
            {% if is_moderator %}
            <a href="/team/{{ team.id }}/edit" class="btn btn-primary">Edit Team</a>
            <form method="POST" action="/team/{{ team.id }}/delete" style="display: inline;">
                <button type="submit" class="btn btn-secondary" 
                    onclick="return confirm('Are you sure you want to delete this team? This action cannot be undone.')">
                    Delete Team
                </button>
            </form>
            {% else %}
            <form method="POST" action="/team/{{ team.id }}/leave" style="display: inline;">
                <button type="submit" class="btn btn-secondary" 
                    onclick="return confirm('Are you sure you want to leave this team?')">
                    Leave Team
                </button>
            </form>
            {% endif %}
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}
